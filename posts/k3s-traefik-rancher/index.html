<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="robots" content="all" /><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="NqibrxbTQ3FPfyJuuSPcSi39c5Qiqf57zoBYqWxd2dg" /><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Configuring Traefik 2 Ingress for Kubernetes" /><meta property="og:locale" content="en" /><meta name="description" content="About" /><meta property="og:description" content="About" /><link rel="canonical" href="https://docs.technotim.live/posts/k3s-traefik-rancher/" /><meta property="og:url" content="https://docs.technotim.live/posts/k3s-traefik-rancher/" /><meta property="og:site_name" content="Techno Tim Documentation" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-08T09:00:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Configuring Traefik 2 Ingress for Kubernetes" /><meta name="twitter:site" content="@technotimlive" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-13T23:14:15-06:00","datePublished":"2021-04-08T09:00:00-05:00","description":"About","headline":"Configuring Traefik 2 Ingress for Kubernetes","mainEntityOfPage":{"@type":"WebPage","@id":"https://docs.technotim.live/posts/k3s-traefik-rancher/"},"url":"https://docs.technotim.live/posts/k3s-traefik-rancher/"}</script><title>Configuring Traefik 2 Ingress for Kubernetes | Techno Tim Documentation</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Techno Tim Documentation"><meta name="application-name" content="Techno Tim Documentation"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1872619258207885" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NZ5V7DM8F5"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NZ5V7DM8F5'); }); </script><link type="application/atom+xml" rel="alternate" href="https://docs.technotim.live/feed.xml" title="Techno Tim Documentation" /><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/1322205?s=400&u=5b4f2219006577dc0426007fe5a02391c4899677&v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Techno Tim Documentation</a></div><div class="site-subtitle font-italic">Video documentation for all your copy pasta needs!</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://twitter.com/technotimlive" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.youtube.com/channel/UCOk-gHyjcWZNj3Br4oxwh0A" aria-label="youtube" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://twitch.tv/technotim" aria-label="twitch" target="_blank" rel="noopener"> <i class="fab fa-twitch"></i> </a> <a href="https://patreon.com/technotim" aria-label="patreon" target="_blank" rel="noopener"> <i class="fab fa-patreon"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="https://discord.gg/akMB4HJpvF" aria-label="discord" target="_blank" rel="noopener"> <i class="fab fa-discord"></i> </a> <a href="https://github.com/timothystewart6" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a><div class="d-flex flex-wrap justify-content-center"><div class="p-1 text-small-left">527 stars</div><div class="p-1">179 forks</div></div></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Configuring Traefik 2 Ingress for Kubernetes</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Configuring Traefik 2 Ingress for Kubernetes</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/technotimlive">Techno Tim</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1617890400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-04-08 </em> </span> <span> Updated <em class="timeago" data-ts="1644815655" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-02-13 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="978 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h2 id="about">About<a href="#about" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>No video currently exists for this (yet)</p><p>This guide is for installing <code class="language-plaintext highlighter-rouge">traefik 2</code> on <code class="language-plaintext highlighter-rouge">k3s</code>. If you‚Äôre not using rancher, that‚Äôs fine, just skip to <code class="language-plaintext highlighter-rouge">Reconfiguring k3s</code></p><p>It assumes you have followed:</p><ul><li><p><a href="https://www.youtube.com/watch?v=UoOcLXfa8EU">HIGH AVAILABILITY k3s (Kubernetes) in minutes!</a></p><li><p><a href="https://www.youtube.com/watch?v=APsZJbnluXg">High Availability Rancher on a Kubernetes Cluster</a></p></ul><p>There is a little bit of ‚Äúundoing‚Äù we‚Äôll have to do since k3s ships with <code class="language-plaintext highlighter-rouge">traefik</code> and Rancher doesn‚Äôt play well with service load balancer. So, we‚Äôll pick up after instaling these two.</p><h2 id="reconfigure-rancher">Reconfigure Rancher<a href="#reconfigure-rancher" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Make note of your version of Rancher</p><p>Remove Rancher</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm uninstall rancher
</pre></table></code></div></div><p>Install Rancher</p><p>(replace with version above)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>helm <span class="nb">install </span>rancher rancher-stable/rancher <span class="se">\</span>
  <span class="nt">--namespace</span> cattle-system <span class="se">\</span>
  <span class="nt">--set</span> <span class="nb">hostname</span><span class="o">=</span>rancher.example.com <span class="se">\</span>
  <span class="nt">--version</span> 2.5.6
</pre></table></code></div></div><h2 id="reconfiguring-k3s">Reconfiguring k3s<a href="#reconfiguring-k3s" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Get the version of <code class="language-plaintext highlighter-rouge">k3s</code> that‚Äôs currently running</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>k3s <span class="nt">--version</span>
<span class="nb">export </span><span class="nv">INSTALL_K3S_VERSION</span><span class="o">=</span>v1.20.5+k3s1
</pre></table></code></div></div><p>Run the same command you ran initially to install <code class="language-plaintext highlighter-rouge">k3s</code> on your servers but add <code class="language-plaintext highlighter-rouge">--disable traefik --disable servicelb</code> and be sure to set your version.</p><p>example (be sure you are using the right version)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">INSTALL_K3S_VERSION</span><span class="o">=</span>v1.20.5+k3s1
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>curl <span class="nt">-sfL</span> https://get.k3s.io | sh <span class="nt">-s</span> - server <span class="nt">--node-taint</span> <span class="nv">CriticalAddonsOnly</span><span class="o">=</span><span class="nb">true</span>:NoExecute <span class="nt">--tls-san</span> your.load.balancer.ip <span class="nt">--write-kubeconfig-mode</span> 644 <span class="nt">--disable</span> traefik <span class="nt">--disable</span> servicelb
</pre></table></code></div></div><p>This should reconfigure your servers. Just run it on all server nodes, not agent nodes.</p><h2 id="install-metal-lb">Install Metal LB<a href="#install-metal-lb" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><a href="https://metallb.universe.tf/installation/">Metal LB installation</a></p><p>You can follow <a href="https://www.youtube.com/watch?v=pAM2GBCDGTo">Self-Hosting Your Homelab Services with SSL</a> to get the idea of Metal LB. It‚Äôs recommended to:</p><ul><li>Install with <a href="https://metallb.universe.tf/installation/#installation-with-helm">helm</a><li>Use <a href="https://metallb.universe.tf/configuration/#layer-2-configuration">Layer2 configuration</a> if you follow this series</ul><h2 id="exposing-rancher-directly-to-your-metal-lb">Exposing Rancher directly to your Metal LB<a href="#exposing-rancher-directly-to-your-metal-lb" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>It‚Äôs a good idea to do this until traefik is configured otherwise you won‚Äôt have access to the Rancher UI</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl expose deployment rancher <span class="nt">-n</span> cattle-system <span class="nt">--type</span><span class="o">=</span>LoadBalancer <span class="nt">--name</span><span class="o">=</span>rancher-lb <span class="nt">--port</span><span class="o">=</span>443
</pre></table></code></div></div><p>Then, you can access Rancher UI after getting external-IP</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl get service/rancher-lb <span class="nt">-n</span> cattle-system
</pre></table></code></div></div><h2 id="install-traefik-2">Install Traefik 2<a href="#install-traefik-2" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>You can can choose between creating <code class="language-plaintext highlighter-rouge">Ingress</code> in Rancher or <code class="language-plaintext highlighter-rouge">IngresRoute</code> with <code class="language-plaintext highlighter-rouge">traefik</code></p><p>If you choose <code class="language-plaintext highlighter-rouge">IngressRoute</code> see <a href="#exposing-a-service-with-traefik-ingressroute">IngressRoute</a> otherwise continue on.</p><ul><li>You must have a persistent volume set up already for <code class="language-plaintext highlighter-rouge">acme.json</code> certificate<li>This uses cloudflare, check providers if you want to switch<li>This will get wildcard certs<li>This is pointed at staging, if you want production be sure comment staging the line (and delete your staging certs)</ul><p>We will be installing this into the <code class="language-plaintext highlighter-rouge">kube-system</code> namespace, which already exists. If you are going to use anther namespace you will need change it everywhere.</p><h3 id="optional-make-sure-that-persistent-volume-claim-is-available">(Optional) Make sure that persistent volume claim is available<a href="#optional-make-sure-that-persistent-volume-claim-is-available" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>The dynamic configuration for Traefik is stored in a persistent volume. If you want to persist the certificate, it‚Äôs better to create one now to claim later.</p><p>To create a persistent volume, it‚Äôs better to check out <a href="https://www.youtube.com/watch?v=eKBBHc0t7bc">Cloud Native Distributed Storage in Kubernetes with Longhorn</a>.</p><p>If not, just create one from <code class="language-plaintext highlighter-rouge">Rancher UI &gt; Clusters (Choose your cluster) &gt; Storage &gt; Persistent Volume &gt; Add volume</code></p><h3 id="add-traefik-helm-repo-and-update">Add <code class="language-plaintext highlighter-rouge">traefik</code> helm repo and update<a href="#add-traefik-helm-repo-and-update" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>helm repo add traefik https://helm.traefik.io/traefik
helm repo update
</pre></table></code></div></div><h3 id="edit--apply-configmap">Edit &amp; apply ConfigMap<a href="#edit--apply-configmap" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Create <code class="language-plaintext highlighter-rouge">traefik-config.yaml</code> with the contents of <code class="language-plaintext highlighter-rouge">/config/traefik-config.yaml</code> from <a href="https://github.com/techno-tim/launchpad/tree/master/kubernetes/traefik2-k3s-rancher/config">/config</a><li>This holds our cloudflare secrets along with a configmap<li>Update this file with your values<li>Re-check if you have a persistent volume ready to claim<li>Apply the config</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> traefik-config.yaml
</pre></table></code></div></div><h3 id="edit--install-traefik-helm-chart">Edit &amp; install Traefik helm chart<a href="#edit--install-traefik-helm-chart" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><ul><li>Create <code class="language-plaintext highlighter-rouge">traefik-chart-values.yaml</code> with the contents of <code class="language-plaintext highlighter-rouge">/config/traefik-chart-values.yaml</code> from <a href="https://github.com/techno-tim/launchpad/tree/master/kubernetes/traefik2-k3s-rancher/config">/config</a><li>Update <code class="language-plaintext highlighter-rouge">loadBalancerIP</code> in <code class="language-plaintext highlighter-rouge">traefik-chart-values.yaml</code> with your Metal LB IP</ul><p>Before running this, be sure you only have one default storage class set.</p><p>If you are using Rancher it is <code class="language-plaintext highlighter-rouge">Cluster &gt; Storage &gt; Storage Classes</code>. Make sure only one is default.</p><ul><li>Install Traefik with chart values</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm <span class="nb">install </span>traefik traefik/traefik <span class="nt">--namespace</span><span class="o">=</span>kube-system <span class="nt">--values</span><span class="o">=</span>traefik-chart-values.yaml
</pre></table></code></div></div><p>More configuration value can be add from this <a href="https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml">default-value.yaml</a> from Traefik github.</p><p>If all went well, you should now have traefik 2 installed and configured.</p><h3 id="check-for-container-logs">Check for container logs<a href="#check-for-container-logs" class="anchor"><i class="fas fa-hashtag"></i></a></h3></h3><p>To check if the Traefik instance is running correctly, see the logs:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl <span class="nt">-n</span> kube-system logs <span class="si">$(</span>kubectl <span class="nt">-n</span> kube-system get pods <span class="nt">--selector</span> <span class="s2">"app.kubernetes.io/name=traefik"</span> <span class="nt">--output</span><span class="o">=</span>name<span class="si">)</span>
</pre></table></code></div></div><p>It should be <code class="language-plaintext highlighter-rouge">level=info msg="Configuration loaded from flags."</code></p><h2 id="traefik-dashboard">Traefik Dashboard<a href="#traefik-dashboard" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>To see all router to Traefik, we can install and expose Traefik Dashboard.</p><p>First you will need <code class="language-plaintext highlighter-rouge">htpassword</code> to generate a password for your dashboard.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>apache2-utils
</pre></table></code></div></div><p>You can then generate one using this, be sure to swap your username and password.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>htpasswd <span class="nt">-nb</span> techno password | openssl <span class="nb">base64</span>
</pre></table></code></div></div><p>It should output:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">dGVjaG5vOiRhcHIxJFRnVVJ0N2E1JFpoTFFGeDRLMk8uYVNaVWNueG41eTAKCg</span><span class="o">==</span>
</pre></table></code></div></div><p>Save this in a secure place, it will be the password you use to access the traefik dashboard.</p><p>Copy <code class="language-plaintext highlighter-rouge">traefik-dashboard-secret.yaml</code> locally and update it with your credentials.</p><p>Copy <code class="language-plaintext highlighter-rouge">traefik-dashboard-ingressroute.yaml</code> and update it with your hostname, then apply:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> traefik-dashboard-secret.yaml
kubectl apply <span class="nt">-f</span> traefik-dashboard-ingressroute.yaml
</pre></table></code></div></div><p>This should create:</p><ul><li>A secret in Kubernetes cluster name <code class="language-plaintext highlighter-rouge">traefik-dashboard-auth</code><li>A middleware for Traefik name <code class="language-plaintext highlighter-rouge">traefik-dashboard-basicauth</code><li>An ingress route for Traefik name <code class="language-plaintext highlighter-rouge">dashboard</code></ul><p>Check out the Traefik Dashboard with the URL you specify earlier.</p><h2 id="exposing-a-service-with-traefik-and-rancher-ingress">Exposing a service with traefik and Rancher Ingress<a href="#exposing-a-service-with-traefik-and-rancher-ingress" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>In Rancher go to Load Balancing</p><ul><li>create ingress<li>choose a host name (service.example.com)<li>choose a target (your workload)<li>set the port to the exposed port within the container<li>go to labels and annotations and add <code class="language-plaintext highlighter-rouge">kubernetes.io/ingress.class</code> = <code class="language-plaintext highlighter-rouge">traefik-external</code><li>note, <code class="language-plaintext highlighter-rouge">traefik-external</code> comes from <code class="language-plaintext highlighter-rouge">--providers.kubernetesingress.ingressclass=traefik-external</code> in <code class="language-plaintext highlighter-rouge">traefik-chart-values.yml</code>. If you used something else, you will need to set your label properly.<li>when you visit your website (<code class="language-plaintext highlighter-rouge">https://service.example.com</code>) you should now see a certificate issues. If it‚Äôs a staging cert, see the note about switching to production in <code class="language-plaintext highlighter-rouge">traefik-chart-values.yaml</code>. After changing, you will need to delete your certs in storage and reapply that file</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kubectl delete <span class="nt">-n</span> kube-system persistentvolumeclaims acme-json-certs
kubectl apply <span class="nt">-f</span> traefik-config.yaml
</pre></table></code></div></div><h2 id="exposing-a-service-with-traefik-ingressroute">Exposing a service with traefik IngressRoute<a href="#exposing-a-service-with-traefik-ingressroute" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>copy the contents of <a href="https://github.com/techno-tim/launchpad/tree/master/kubernetes/traefik2-k3s-rancher/config-ingress-route/kubernetes">config-ingress-route/kubernetes</a> to your local machine</p><p>then run</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kubectl apply <span class="nt">-f</span> kubernetes
</pre></table></code></div></div><p>This will create the deployment, service, and ingress.</p><p>See all the hardware I recommend at <a href="https://kit.co/TechnoTim">https://kit.co/TechnoTim</a></p><p>Don‚Äôt forget to check out the <a href="https://l.technotim.live/quick-start">üöÄLaunchpad repo</a> with all of the quick start source files.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>kubernetes</a>, <a href='/categories/rancher/'>rancher</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/homelab/" class="post-tag no-text-decoration" >homelab</a> <a href="/tags/rancher/" class="post-tag no-text-decoration" >rancher</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/k3s/" class="post-tag no-text-decoration" >k3s</a> <a href="/tags/traefik/" class="post-tag no-text-decoration" >traefik</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Configuring Traefik 2 Ingress for Kubernetes - Techno Tim Documentation&amp;url=https://docs.technotim.live/posts/k3s-traefik-rancher/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Configuring Traefik 2 Ingress for Kubernetes - Techno Tim Documentation&amp;u=https://docs.technotim.live/posts/k3s-traefik-rancher/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://docs.technotim.live/posts/k3s-traefik-rancher/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/k3s-traefik-rancher/">Configuring Traefik 2 Ingress for Kubernetes</a><li><a href="/posts/authelia-traefik/">2 Factor Auth and Single Sign on with Authelia</a><li><a href="/posts/webtop-container/">Linux desktop, inside of a container, inside of a browser??? Yes. A Webtop.</a><li><a href="/posts/self-hosting-security/">Self-Hosting Security Guide for your HomeLab</a><li><a href="/posts/windows-11-proxmox/">Virtualize Windows 11 with Proxmox the Right Way!</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/rancher/">rancher</a> <a class="post-tag" href="/tags/self-hosted/">self-hosted</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/portainer/">portainer</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/reverse-proxy-kubernetes/"><div class="card-body"> <em class="timeago small" data-ts="1597500000" > 2020-08-15 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Self-Hosting Your Homelab Services with SSL -- Let's Encrypt, MetalLB, Traefik, Rancher, Kubernetes</h3><div class="text-muted small"><p> Are you self-hosting lots of services at home in your homelab? Have you been port forwarding or using VPN to access your self-hosted services wishing you had certificates so that you can access ...</p></div></div></a></div><div class="card"> <a href="/posts/rancher-ha-install/"><div class="card-body"> <em class="timeago small" data-ts="1608386400" > 2020-12-19 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>High Availability Rancher on kubernetes</h3><div class="text-muted small"><p> Are you running Kubernetes in your homelab or in the enterprise? Do you want an easy way to manage and create Kubernetes clusters? Join me as we walk through installing Rancher on an existing hig...</p></div></div></a></div><div class="card"> <a href="/posts/longhorn-install/"><div class="card-body"> <em class="timeago small" data-ts="1609596000" > 2021-01-02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cloud Native Distributed Storage in Kubernetes with Longhorn</h3><div class="text-muted small"><p> Storage in Kubernetes is hard, complicated, and messy. Configuring volumes, mounts, and persistent volumes claims and getting it right can be a challenge. It‚Äôs also challenging to manage that s...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rancher-new-ui/" class="btn btn-outline-primary" prompt="Older"><p>Everything you need to know about the NEW Rancher UI</p></a> <a href="/posts/rancher-monitoring/" class="btn btn-outline-primary" prompt="Newer"><p>Monitoring Your Kubernetes Cluster with Grafana, Prometheus, and Alertmanager</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> ¬© 2022 <a href="https://twitter.com/technotimlive">Techno Tim</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/rancher/">rancher</a> <a class="post-tag" href="/tags/self-hosted/">self-hosted</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/portainer/">portainer</a> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', limit: 10000, templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-NZ5V7DM8F5"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-NZ5V7DM8F5'); }); </script>
